<!DOCTYPE html>
<html>
<head>
    <title>Crypto Chart</title>
</head>
<style>
    /* Set the font for all tables */
    table {
        font-family: Arial, sans-serif;
        width: 100%; /* Make all tables the same width */
        table-layout: fixed; /* Enable word-wrapping for cells */
        margin-top: 1em; /* Add vertical space above the table */
        margin-bottom: 1em; /* Add vertical space below the table */
    }

    /* Align all text in tables to the left */
    table th, table td {
        text-align: left;
    }

    /* Make the action names bold */
    table .action {
        font-weight: bold;
    }
</style>
<body>
    <div id="dataContainer"></div>
    <script>
        // Configurable values
        const apiKey = 'YOUR_BINANCE_API_KEY';
        const apiSecret = 'YOUR_BINANCE_API_SECRET';
        const symbols = ["BTCUSDT", "ETHUSDT"];
        
        // Ichimoku Cloud settings
        const conversionPeriods = 9;
        const basePeriods = 26;
        const laggingSpan2Periods = 52;
        const displacement = 26;

        function donchian(len, data) {
            const slice = data.slice(-len);
            const low = Math.min(...slice.map(kline => parseFloat(kline[3])));
            const high = Math.max(...slice.map(kline => parseFloat(kline[2])));
            return (low + high) / 2;
        }

        // Data fetch function
        const fetchData = async () => {
            for (const symbol of symbols) {
                // Pause for 200 ms
                await new Promise(resolve => setTimeout(resolve, 200));

                const response = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1h&limit=120`, {
                    headers: {
                        //'X-MBX-APIKEY': apiKey
                    }
                });
                const data = await response.json();
                
                const currentPrice = parseFloat(data[data.length - 1][4]);
                const currentPrice26PeriodsAgo = parseFloat(data[data.length - 26 - 1][4]);
                const conversionLine = donchian(conversionPeriods, data);
                const baseLine = donchian(basePeriods, data);
                const leadLine1 = (conversionLine + baseLine) / 2;
                const leadLine2 = donchian(laggingSpan2Periods, data);
                const leadLine1Past = (data.length > 26) ? ((donchian(conversionPeriods, data.slice(0, -26)) + donchian(basePeriods, data.slice(0, -26))) / 2) : null;
                const leadLine2Past = (data.length > 26) ? donchian(laggingSpan2Periods, data.slice(0, -26)) : null;

                let action = "NONE";
                let attention = "";
                let actionColor = null;
                if (leadLine1 > leadLine2 && conversionLine > baseLine && currentPrice > conversionLine && currentPrice > leadLine1Past && currentPrice > leadLine2Past && currentPrice26PeriodsAgo > currentPrice) {
                    action = "LONG";
                    actionColor = "green";
                } else if (leadLine2 > leadLine1 && baseLine > conversionLine && conversionLine > currentPrice && currentPrice < leadLine1Past && currentPrice < leadLine2Past && currentPrice > currentPrice26PeriodsAgo) {
                    action = "SHORT";
                    actionColor = "red";
                } else if (Math.abs(baseLine - conversionLine) < 0.005 * currentPrice) {
                    action = "EXIT";
                    actionColor = "violet";
                } 

                if (Math.abs(leadLine1 - leadLine2) < 0.005 * currentPrice) {
                    attention = "!!!";
                }

                const dataContainer = document.getElementById('dataContainer');
                let table = document.getElementById(symbol);
                if (!table) {
                    table = document.createElement('table');
                    table.id = symbol;
                    const headerRow = document.createElement('tr');
                    ['Symbol', 'Current Price', 'GREEN', 'BLUE', 'GREEN Lead', 'RED Lead', 'GREEN Lead Now', 'RED Lead Now', 'Lagging', 'Action', 'Time'].forEach(header => {
                        const th = document.createElement('th');
                        th.textContent = header;
                        headerRow.appendChild(th);
                    });
table.appendChild(headerRow);
                    dataContainer.appendChild(table);
                }

                const row = document.createElement('tr');
                [symbol, currentPrice, conversionLine, baseLine, leadLine1, leadLine2, leadLine1Past, leadLine2Past, currentPrice26PeriodsAgo - currentPrice, action + attention, new Date().toLocaleString()].forEach(cellData => {
                    const td = document.createElement('td');
                    
                    if (cellData === action) {
                        const strong = document.createElement('strong');
                        strong.textContent = cellData;
                        td.appendChild(strong);
                    } else {
                        td.textContent = cellData;
                    }

                    row.appendChild(td);
                });
                table.appendChild(row);
            }
        };

        // Fetch data every 5 minutes
        fetchData(); // initial fetch
        setInterval(fetchData, 300000);
    </script>
</body>
</html>
